<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BoardDao">
	
	<!-- getList -->
	<select id="pagingbd" parameterType="Board" resultType="Board">

select *
from(select rownum no, b.*		
			 FROM(Select rownum rn , a.*
			      From   (SELECT           *
						  FROM             board bd
						  LEFT OUTER JOIN  memberinfo mb 
						  ON               bd.id = mb.id
				 		  WHERE            re_level=0 
						  ORDER BY         ref asc
						  ) a
		   		  ) b
	 ORDER BY b.rn desc)
WHERE (no between #{start} and #{end})					<!-- #{start} and #{end} -->
	
	 				
					
					
	</select>
	

	
	
	<!-- total -->
	<select id="dyboardTotal" resultType="int">
		select count(*) 
		FROM   board
		where  re_level=0
	</select>
	
	
	
	
	<!-- detailboard, updateForm -->
	<select id="dyBoardSelOne" parameterType="int" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		WHERE (ref = #{ref}) and bd.re_level=0
	</select>
	
	<!-- 조회수 -->
	<update id="dyViewCnt" parameterType="int">
		UPDATE board
		SET views = views+1
		WHERE (ref = #{ref}) and re_level=0
	</update>
	
	
	<!--게시글 update -->
	<update id="dyBoardUpdate" parameterType="Board">
		 update board 
		 set    title=#{title}, content=#{content}, uploaddate=sysdate
		 where (b_num=#{b_num}) and re_level=0 
	</update>
	<!-- 상세게시판 댓글 리턴 -->
	<select id="dyReplySelOne" parameterType="int" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		WHERE (ref = #{ref}) and bd.re_level=1
	</select>
	
	
	<!-- <select id="writeBoard" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		where re_level=0
	</select> -->
	
	<!-- write insert -->
	<insert id="dyBoardInsert" parameterType="Board">
	     INSERT  
	     INTO  board(B_NUM,ID,UPLOADDATE,TITLE,CONTENT,VIEWS,REF,RE_LEVEL,RE_STEP) b
	     values(COINBD_SEQ.NEXTVAL,#{id},sysdate,#{title},#{content},#{views},REF_SEQ.NEXTVAL,#{re_level},#{re_step})
	     WHERE b.id=(select id
			    	 from   memberinfo m
			    	 where  m.nickname = #{nickname}) 
 	</insert>
	
	
	
	<!--게시글 delete -->
	<delete id="delete" parameterType="int">
		DELETE FROM board 
		WHERE ref = #{ref} AND re_level=0;
	</delete>
	<!--댓글 delete -->
	<delete id="dyReplyDelete" parameterType="Board">
		DELETE FROM board 
		WHERE  ref = #{ref} AND re_level=1 AND re_step = #{re_step};
	</delete>
	
	
	
	<!-- 댓글 입력 부분-->
	<insert id="dyReplyResult" parameterType="Board">
		INSERT
		INTO   board(B_NUM,ID,UPLOADDATE,TITLE,CONTENT,VIEWS,REF,RE_LEVEL,RE_STEP)
		values (#{b_num},#{id},to_date(sysdate,'YYYY-MM-DD HH24:mi:SS'),#{title},#{content},#{views},#{ref},#{re_level},RESTEP_SEQ.NEXTVAL)
	</insert>
	
	<!-- 댓글가져가기 -->	
	<select id="dyLevOne" parameterType="int" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		WHERE  (bd.ref=#{ref} and bd.re_level=1) order by bd.re_step DESC
	</select>	

	<!-- 댓글 수정부분 -->
	<update id="dyReplyUpdate" parameterType="Board" >
	UPDATE board 
	SET    content=#{content} AND uploaddate=sysdate	 
	WHERE  ref=#{ref} AND id=#{id} AND re_step=#{re_step} AND re_level=1
	</update>

	
</mapper>
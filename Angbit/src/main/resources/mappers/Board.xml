<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BoardDao">
	
	<!-- getList -->
	<select id="pagingbd" parameterType="Board" resultType="Board">
		SELECT *
		FROM
		  (
		    Select rownum rn , a.*
		    From   (SELECT  *
			FROM
			 board bd
			LEFT OUTER JOIN
			 memberinfo mb
			ON 
			 bd.id = mb.id
			ORDER BY bd.b_num DESC) a
		  )
			WHERE (rn between #{start} and #{end}) and re_level=0  
	</select>
	
	
	
	
	
	<!-- total -->
	<select id="dyboardTotal" resultType="int">
		select count(*) 
		FROM board
		where re_level=0
	</select>
	
	
	
	
	<!-- detail, updateForm -->
	<select id="dyBoardSelOne" parameterType="int" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		WHERE (b_num = #{b_num}) and bd.re_level=0
	</select>
	
	<!-- 조회수 -->
	<update id="dyViewCnt" parameterType="int">
		UPDATE board
		SET views = views+1
		WHERE (b_num = #{b_num}) and re_level=0
	</update>
	
	
	<!-- update -->
	<update id="dyBoardUpdate" parameterType="Board">
		 update board 
		 set    title=#{title}, content=#{content}, uploaddate=sysdate
		 where (b_num=#{b_num}) and re_level=0 
	</update>
	
	<!-- <select id="writeBoard" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		where re_level=0
	</select> -->
	
	<!-- write insert -->
	<insert id="dyBoardInsert" parameterType="Board">
	     INSERT  
	     INTO  board b
	     values(#{title},#{content})
	     WHERE b.id=(select id
			    	 from   memberinfo m
			    	 where  m.nickname = #{nickname}) 
 	</insert>
	
	
	
	<!-- delete -->
	<delete id="delete" parameterType="int">
		delete from BOARD where b_num = #{b_num}
	</delete>
	
	
	<!-- 댓글 수정중-->
	
	<insert id="dyReplyResult" parameterType="Board">
		INSERT
		INTO   board(B_NUM,ID,UPLOADDATE,TITLE,CONTENT,VIEWS,REF,RE_LEVEL,RE_STEP)
		values (#{b_num},#{id},sysdate,#{title},#{content},#{views},#{ref},#{re_level},#{re_step+1})
	</insert>
		
	<select id="dyLevOne" parameterType="int" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		WHERE  (bd.ref=#{ref} and bd.re_level=1) order by bd.re_step DESC
	</select>	



	
</mapper>
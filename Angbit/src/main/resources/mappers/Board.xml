<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BoardDao">
	
	<!-- getList -->
	<select id="pagingbd" parameterType="Board" resultType="Board">
		SELECT *
		FROM
		  (
		    Select rownum rn , a.*
		    From   (SELECT  *
			FROM
			 board bd
			LEFT OUTER JOIN
			 memberinfo mb
			ON 
			 bd.id = mb.id
			ORDER BY bd.ref DESC) a
		  )
			WHERE (rn between #{start} and #{end}) and re_level=0  
	</select>
	

	
	
	<!-- total -->
	<select id="dyboardTotal" resultType="int">
		select count(*) 
		FROM board
		where re_level=0
	</select>
	
	
	
	
	<!-- detailboard, updateForm -->
	<select id="dyBoardSelOne" parameterType="int" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		WHERE (ref = #{ref}) and bd.re_level=0
	</select>
	
	<!-- 조회수 -->
	<update id="dyViewCnt" parameterType="int">
		UPDATE board
		SET views = views+1
		WHERE (ref = #{ref}) and re_level=0
	</update>
	
	
	<!--게시글 update -->
	<update id="dyBoardUpdate" parameterType="Board">
		 update board 
		 set    title=#{title}, content=#{content}, uploaddate=sysdate
		 where (b_num=#{b_num}) and re_level=0 
	</update>
	
	<!-- <select id="writeBoard" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		where re_level=0
	</select> -->
	
	<!-- write insert -->
	<insert id="dyBoardInsert" parameterType="Board">
	     INSERT  
	     INTO  board(B_NUM,ID,UPLOADDATE,TITLE,CONTENT,VIEWS,REF,RE_LEVEL,RE_STEP) b
	     values(b.MAX(B_NUM)+1,id,sysdate,#{title},#{content},views,ref,re_level,re_step)
	     WHERE b.id=(select id
			    	 from   memberinfo m
			    	 where  m.nickname = #{nickname}) 
 	</insert>
	
	
	
	<!--게시글 delete -->
	<delete id="delete" parameterType="int">
		DELETE FROM board 
		WHERE ref = #{ref} AND re_level=0;
	</delete>
	<!--댓글 delete -->
	<delete id="dyReplyDelete" parameterType="int">
		DELETE FROM board 
		WHERE  ref = #{ref} AND re_level=1;
	</delete>
	
	
	
	<!-- 댓글 추가부분-->
	<insert id="dyReplyResult" parameterType="Board">
		INSERT
		INTO   board(B_NUM,ID,UPLOADDATE,TITLE,CONTENT,VIEWS,REF,RE_LEVEL,RE_STEP)
		values (#{b_num},#{id},to_date(sysdate,'YYYY-MM-DD HH24:mi:SS'),#{title},#{content},#{views},#{ref},#{re_level},#{re_step}+1)
	</insert>
	
	<!-- 댓글가져가기 -->	
	<select id="dyLevOne" parameterType="int" resultType="Board">
		SELECT * 
		FROM Board bd
		LEFT OUTER JOIN memberinfo mb
		ON bd.id = mb.id
		WHERE  (bd.ref=#{ref} and bd.re_level=1) order by bd.re_step DESC
	</select>	



	
</mapper>
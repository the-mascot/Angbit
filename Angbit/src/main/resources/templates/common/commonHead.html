<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

<!-- Common CSS -->
<link href="css/common.css" rel="stylesheet" type="text/css">
<link href="css/status.css" rel="stylesheet" type="text/css">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@700&display=swap" rel="stylesheet">

 <!-- Toastr -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<!-- SockJS -->
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<!-- STOMP -->
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>

<!-- 매매체결 토스트 알람 -->
<script type="text/javascript">

	/*<![CDATA[*/
	var sessionID = "[[${session.sessionID}]]"
	/*]]>*/
	
	function toastrBtn(msg) {
		Command: toastr["success"](msg)

		toastr.options = {
		  "closeButton": true,
		  "debug": false,
		  "newestOnTop": false,
		  "progressBar": true,
		  "positionClass": "toast-bottom-right",
		  "preventDuplicates": false,
		  "showDuration": "4000",
		  "hideDuration": "1000",
		  "timeOut": "5000",
		  "extendedTimeOut": "1000",
		  "showEasing": "swing",
		  "hideEasing": "linear",
		  "showMethod": "fadeIn",
		  "hideMethod": "fadeOut"
		}
	}
	
	function init() {
		console.log('init() Start...');
		alarmWebSocket();
	}
	
	var sock = null;
	function alarmWebSocket() {
		sock = new SockJS("ws/chat");
		var stomp = Stomp.over(sock);
		stomp.connect({}, function(frame) {
			console.log('Alarm WebSock Connected!');
			stomp.subscribe("/topic/"+sessionID, function(frame) {
			console.log(frame.body);
			toastrBtn(frame.body);
			})
		})
		
/* 		sock.onopen = function(evt) { onAlarmOpen(evt) ;};			// websocket.onopen 	= 웹소켓 연결 성공시 수행되는 함수
		sock.onclose = function(evt) { onAlarmClose(evt) };			// websoket.onclose 	= 웹소켓 연결 닫을때 수행되는 함수
		sock.onmessage = function(evt) { onAlarmMessage(evt) };		// websoket.onmessage 	= 서버쪽에서 데이터 수신 받을때 수행되는 함수
		sock.onerror = function(evt) { onAlarmError(evt) };			// websoket.onerror 	= 웹소켓 연결 실패시 수행되는 함 */
	};
	
	function onAlarmOpen(evt) {
		console.log('onAlarmOpen : Alarm WebSocket 연결성공')
	}
	
	function onAlarmMessage(evt) {
		var data = evt.data;
		console.log('onAlarmMessage->'+data);
	}
	
	function onAlarmClose(evt) {
		sock.close();
		console.log("onAlarmClose : Alarm WebSocket 연결해제");
	}
	
	function onAlarmError(evt) {
		console.log('onAlarmError->'+evt.data);
	}
	
	function sendMessage() {
		$.ajax({
			type		:	'GET',
			url			:	'invest/call',
			success		:	function() {
				console.log("call 접속")
			},
			error		:	function(e) {
				console.log("error : ",e);
			}
		});
	}
	
</script>

</html>